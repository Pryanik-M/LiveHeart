{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–∏ –ø–∞—Ü–∏–µ–Ω—Ç—ã</title>
    <link rel="stylesheet" href="{% static 'patients/css/history_patient.css' %}">
</head>
<body>

<div class="history-page-container">
    <div class="history-wrapper">
        <div class="back-link">
            <a href="{% url 'accounts:dashboard' %}">‚Üê –ù–∞–∑–∞–¥</a>
        </div>

        <div class="card header-card">
            <div class="header-left">
                <h1>–ú–æ–∏ –ø–∞—Ü–∏–µ–Ω—Ç—ã</h1>
            </div>

            <div class="header-right">
                <div class="search-box">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞...">
                    <button class="search-btn">üîçÔ∏é</button>
                </div>
                <a href="{% url 'patients:new_patient' %}" class="primary-btn">+ –ù–æ–≤—ã–π –ø–∞—Ü–∏–µ–Ω—Ç</a>
            </div>
        </div>
        <div class="card table-card">
            <table class="patients-table">
                <thead>
                    <tr>
                        <th>–§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for patient in patients %}
                    <tr>
                        <td class="patient-name">{{ patient.full_name }}</td>
                        <td>
                            {% with last_exam=patient.examination_set.last %}
                                {% if last_exam %}
                                    {{ last_exam.exam_datetime|date:"d.m.Y H:i" }}
                                {% else %}
                                    <span class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td class="actions-cell">
                            <a href="#" class="link-btn">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</a>
                            <form method="post" action="{% url 'patients:delete_patient' patient.id %}" class="delete-form" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è?');">
                                {% csrf_token %}
                                <button type="submit" class="delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="empty-row">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

</body>
</html>